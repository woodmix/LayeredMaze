
[rem]

●dataの記述について。

    そのフロアのデータを表すコレクション。

        start       ゲーム開始時の開始位置。[data 0]のみに現れる。[0]:X [1]:Y

        gimmicks    そのフロアに設置されているギミックを値、ギミック名をキーとして列挙するコレクション。

    ○gimmicks

        ・ギミック名は自由に決められる。

        ・各ギミックは次のキーを持つ。
            trigger     起動条件。省略した場合は自動的には起動しないギミックとなる。
            command     起動したときに実行されるコマンド。複数ある場合はbatchコマンドを使って記述する。
            ornament    ギミックを表示するために使うシンボル種別。以下のいずれか。
                            fruit           リンゴ
                            cannon-xxxx     大砲。xxxx は向き: "left", "upper", "right", "lower" のいずれか。
                            stair-downward  下り階段
                            stair-upward    上り階段
                            exitport        出口
            oneshot     trueにすると、一度起動したらなくなるようになる。
            shorthand   一部の典型的ギミックのテンプレートを呼び出す。

        ・trigger(起動条件)は次のキーを持つコレクション。各キーは基本的に OR で判定される(いずれかの条件が満たされたら起動)が、一部例外もある。
            unit    条件チェックを行わせたユニットがここで指定されたコードを持つこと。他のキーとは AND で評価される。
            into    ユニットがここで指定されたマスに侵入すること。[0]:X [1]:Y の二つの要素を持つ序数配列で指定する。

    ○ショートハンド

        shorthandキーに設定された値に対応するテンプレートが使用される。その他に設定されているキーはショートハンドのパラメータとして参照されるととにも、
        テンプレートに対する上書き値としても作用する。以下のショートハンドが定義されている。

            scorepoint      スコアギミック
                            {
                                "trigger": {"into":posキー, "unit":"player"},
                                "ornament": "fruit",
                                "oneshot": true,
                                "command": {"type":"score", "value":100, "point":posキー}
                            }

            cannon          大砲ギミック
                            {
                                "trigger": {"into":posキー, "unit":"player"},
                                "ornament": "cannon-" + dirキー,
                                "command": {"type":"kick", "target":ギミック名, "method":"act"}
                            }

            downstairs      下り階段
                            {
                                "trigger": {"into":posキー, "unit":"player"},
                                "ornament": "stair-downward",
                                "command": {"type":"stair", "updown":"down", "port":ギミック名}
                            }

            upstairs        上り階段
                            {
                                "trigger": {"into":posキー, "unit":"player"},
                                "ornament": "stair-upward",
                                "command": {"type":"stair", "updown":"up", "port":ギミック名}
                            }

    ○コマンド

        コマンドは任意のキーを持つコレクション。値にオブジェクトを持つキーを必要とするコマンドは内部で使用しているもの。JSONで記述することは出来ない。

        共通のキー
            type            必ず存在する。まずはここを見て他のキーの意味を汲み取る。
            parallelizable  このコマンドが完了する前に後続のコマンドを実行開始してよいかどうか。trueのコマンドが続く場合、並列実行される場合がある。
                            省略した場合は type を元に自動的に判別される。

        -- パラメータ管理系(発効されたらすぐ終了する)・特殊系

            type: score
                スコアを獲得。
                value       いくつ獲得するか
                point       発生位置

            type: kick
                指定された置物の、特定のメソッドを呼び出す。
                target      対象置物の名前
                method      呼び出すメソッド名

            type: wait
                特定の事象が発生するまで待機する。
                ant         ステージ素子にこの素子が存在している限り待機。
                scene

            type: voila
                指定されたボックスに指定されたエフェクトをセットする。
                effect      エフェクトの種類。以下のいずれか。
                                explosion       爆発。今のところ画面振動もセットになっている。
                point       発生位置

            type: remove
                ギミックを取り除く。
                target      対象ギミックのキー。

            type: batch
                複数のコマンドを同時に実行するためのコマンド。
                commands    同時に実行するコマンドの配列。

        -- ステージ終了系(コマンド処理が完了することはない)

            type: stair
                フロアの移動
                updown      上昇なら "up"、降下なら "down"
                port        移動後のフロアに渡す経路値。開始位置の参照に使われる。

            type: goal
                ゲームクリア

            type: miss
                ゲームオーバー

        -- ユニットのアクション系

            type: act
                ユニットが一回行動する。
                unit        対象のユニット。UnitExecutantオブジェクト。

            type: falldown
                ユニットが倒れる。
                unit        対象のユニット。UnitExecutantオブジェクト。

[cragmap]

 01 99 01 01
 01 01 01 01
 01 01 01 01
 01 01 01 01

[lowerground 0]

 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 -- -- -- -- -- -- -- -- -- -- 00 00 00 00 00 00
 -- -- -- -- -- -- -- -- -- -- 00 00 00 00 00 00
 -- -- -- -- -- -- -- -- -- -- 00 00 00 00 00 00

[upperground 0]

 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10
 10 10 10 10 10 10 10 10 10 10 10 -- 10 -- -- 10
 -- -- -- -- -- -- -- -- -- -- 10 -- 10 -- -- 10
 -- -- -- -- -- -- -- -- -- -- 10 -- 10 -- -- 10
 -- -- -- -- -- -- -- -- -- -- 10 10 10 10 10 10

[data 0]

{
    "start": { "gamestart":[1,1], "stairs-a":[11,3] },
    "enemies": [ [13,4], [14,3] ],
    "gimmicks": {
        "stairs-a": {"shorthand":"downstairs", "pos":[11,4] },
        "score-01": {"shorthand":"scorepoint", "pos":[4,1]},
        "cannon-01": {"shorthand":"cannon", "pos":[8,1], "dir":"right"},
        "score-02": {"shorthand":"scorepoint", "pos":[14,4]}
    }
}

[lowerground-1]

 00 00 00 00 00 00 00 00 -- -- --
 00 00 00 00 00 00 00 00 -- -- --
 00 00 00 00 00 00 00 00 -- -- --
 -- -- 00 00 00 00 00 00 -- -- --
 -- -- 00 00 00 00 -- -- -- -- --
 -- -- 00 00 00 00 -- -- -- -- --
 -- -- 00 00 00 00 -- -- -- -- --
 00 00 00 00 00 -- -- -- -- -- --
 00 00 00 00 00 -- -- -- -- -- --
 00 00 00 00 00 00 00 00 00 00 00
 -- -- 00 00 00 00 00 00 00 00 00
 -- -- 00 00 00 00 00 00 00 00 00
 -- -- 00 00 00 00 00 00 00 00 00
 -- -- -- -- -- -- -- 00 00 00 00

[upperground-1]

 10 10 10 10 10 10 10 10 -- -- --
 10 -- -- -- -- -- -- 10 -- -- --
 10 10 10 -- 10 -- -- 10 -- -- --
 -- -- 10 -- 10 10 10 10 -- -- --
 -- -- 10 -- 10 10 -- -- -- -- --
 -- -- 10 -- -- 10 -- -- -- -- --
 -- -- 10 -- 10 10 -- -- -- -- --
 10 10 10 -- 10 -- -- -- -- -- --
 10 -- -- -- 10 -- -- -- -- -- --
 10 10 10 -- 10 10 10 10 10 10 10
 -- -- 10 -- 10 -- 10 10 -- -- 10
 -- -- 10 -- -- -- -- -- -- -- 10
 -- -- 10 10 10 10 10 10 -- -- 10
 -- -- -- -- -- -- -- 10 10 10 10

[data-1]

{
    "start": { "stairs-a":[2,1], "stairs-b":[3,5], "stairs-c":[5,11] },
    "enemies": [ [6,2], [1,8] ],
    "gimmicks": {
        "stairs-a": {"shorthand":"upstairs", "pos":[1,1] },
        "cannon-01": {"shorthand":"cannon", "pos":[3,4], "dir":"upper"},
        "stairs-b": {"shorthand":"downstairs", "pos":[4,5] },
        "stairs-c": {"shorthand":"downstairs", "pos":[5,10] },
        "score-01": {"shorthand":"scorepoint", "pos":[9,10]},
        "score-02": {"shorthand":"scorepoint", "pos":[9,11]},
        "score-03": {"shorthand":"scorepoint", "pos":[9,12]}
    }
}

[lowerground-2]

 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- 00 00 00 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- 00 00 00 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 -- -- -- -- -- -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

[upperground-2]

 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 --
 10 -- -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- 10 --
 10 10 10 -- 10 10 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- 10 -- 10 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- 10 -- 10 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 10 -- 10 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- 10 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 10 10 10 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- -- -- 10 10
 -- -- -- -- -- -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- 10
 -- -- -- -- -- -- 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10

[data-2]

{
    "start": { "stairs-b":[2,1], "stairs-c":[3,6], "stairs-d":[18,12] },
    "enemies": [ [10,1], [8,7], [8,11], [11,12], [12,10], [15,12], [14,11], [18,10], [16,8], [17,5], [16,2], [13,3] ],
    "gimmicks": {
        "stairs-b": {"shorthand":"upstairs", "pos":[1,1] },
        "stairs-c": {"shorthand":"upstairs", "pos":[2,6] },
        "stairs-d": {"shorthand":"downstairs", "pos":[19,12] },
        "cannon-00": {"shorthand":"cannon", "pos":[5,1], "dir":"right"},
        "cannon-01": {"shorthand":"cannon", "pos":[10,4], "dir":"right"},
        "cannon-02": {"shorthand":"cannon", "pos":[16,4], "dir":"lower"},
        "cannon-03": {"shorthand":"cannon", "pos":[16,9], "dir":"left"},
        "cannon-04": {"shorthand":"cannon", "pos":[10,9], "dir":"upper"}
    }
}

[lowerground-3]

 -- -- -- -- -- -- -- 00 00 00 00 00 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 00 00 00 00 00 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 00 00 00 00 00 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 00 00 00 00 00 -- -- -- -- -- -- --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 -- 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 --
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

[upperground-3]

 -- -- -- -- -- -- -- 10 10 10 10 10 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 10 -- -- -- 10 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 10 -- -- -- 10 -- -- -- -- -- -- --
 -- -- -- -- -- -- -- 10 -- -- -- 10 -- -- -- -- -- -- --
 -- 10 10 10 10 10 10 10 10 -- 10 10 10 10 10 10 10 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 -- 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 --
 10 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10 10
 10 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 10
 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10

[data-3]

{
    "start": { "stairs-d":[16,19] },
    "enemies": [ [4,14], [14,8] ],
    "gimmicks": {
        "stairs-d": {"shorthand":"upstairs", "pos":[17,19] },

        "score-01": {"shorthand":"scorepoint", "pos":[ 8,1]},
        "score-02": {"shorthand":"scorepoint", "pos":[ 9,1]},
        "score-03": {"shorthand":"scorepoint", "pos":[10,1]},
        "score-04": {"shorthand":"scorepoint", "pos":[ 8,2]},
        "score-05": {"shorthand":"scorepoint", "pos":[ 9,2]},
        "score-06": {"shorthand":"scorepoint", "pos":[10,2]},
        "score-07": {"shorthand":"scorepoint", "pos":[ 8,3]},
        "score-08": {"shorthand":"scorepoint", "pos":[ 9,3]},
        "score-09": {"shorthand":"scorepoint", "pos":[10,3]},

        "score-10": {"shorthand":"scorepoint", "pos":[4,6]},
        "score-11": {"shorthand":"scorepoint", "pos":[6,8]},
        "score-12": {"shorthand":"scorepoint", "pos":[12,8]},
        "score-13": {"shorthand":"scorepoint", "pos":[16,5]},
        "score-14": {"shorthand":"scorepoint", "pos":[3,12]},
        "score-15": {"shorthand":"scorepoint", "pos":[9,12]},
        "score-16": {"shorthand":"scorepoint", "pos":[15,11]},
        "score-17": {"shorthand":"scorepoint", "pos":[3,17]},
        "score-18": {"shorthand":"scorepoint", "pos":[7,16]},
        "score-19": {"shorthand":"scorepoint", "pos":[10,18]},
        "score-20": {"shorthand":"scorepoint", "pos":[14,15]},

        "goal": {
            "trigger": {"into":[1,19], "unit":"player"},
            "ornament": "exitport",
            "command": {"type":"goal"}
        }
    }
}
